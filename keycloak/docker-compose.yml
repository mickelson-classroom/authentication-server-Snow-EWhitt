version: '3'

services:
  ethan-keycloak:
    container_name: ethan-keycloak
    image: bitnami/keycloak
    environment:
      - KEYCLOAK_ADMIN_USER=${KEYCLOAK_ADMIN_USER}
      - KEYCLOAK_ADMIN_PASSWORD=${KEYCLOAK_ADMIN_PASS}
      - KEYCLOAK_DATABASE_HOST=ethan-keycloak-database
      - KEYCLOAK_DATABASE_NAME=${POSTGRESQL_DB}
      - KEYCLOAK_DATABASE_USER=${POSTGRESQL_USER}
      - KEYCLOAK_DATABASE_PASSWORD=${POSTGRESQL_PASS}
    # ports:
    #   - 8007:8080
    restart: unless-stopped

  ethan-keycloak-database:
    container_name: ethan-keycloak-database
    image: postgres
    environment:
      - POSTGRES_USER=${POSTGRESQL_USER}
      - POSTGRES_PASSWORD=${POSTGRESQL_PASS}
      - POSTGRES_DB=${POSTGRESQL_DB}
    volumes:
      - /home/ethan/data/keycloak_postgres:/var/lib/postgresql/data
    restart: unless-stopped
 
  ethan-keycloak-swag:
    container_name: ethan-keycloak-swag
    image: lscr.io/linuxserver/swag
    cap_add:
      - NET_ADMIN
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=America/Denver
      - URL=ethan-keycloak.duckdns.org
      - VALIDATION=duckdns
      - DUCKDNSTOKEN=${DUCKDNSTOKEN}
      - STAGING=false
    volumes:
      - /home/ethan/data/keycloak-swag:/config
      - ./swag-default.conf:/config/nginx/site-confs/default.conf
    ports:
    - 0.0.0.0:8007:443
    restart: unless-stopped
